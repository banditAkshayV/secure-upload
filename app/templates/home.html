<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ðŸ”’ Digital Confession Booth - Where Secrets Go to Die</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Creepster&family=Butcherman&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='mystyle.css') }}">
  
  <style>
    .confession-column {
      max-width: 400px;
      word-wrap: break-word;
      word-break: break-word;
      white-space: pre-wrap;
    }
    
    .confession-text {
      word-wrap: break-word;
      word-break: break-word;
      overflow-wrap: break-word;
      white-space: pre-wrap;
      line-height: 1.5;
    }
  </style>

</head>
<body>
  <div class="container py-4">
    <!-- Scary Header -->
    <div class="text-center mb-5">
      <h1 class="main-title glitch">
        <i class="bi bi-eye-slash scary-icon"></i>
        Digital Confession Booth
        <i class="bi bi-skull scary-icon"></i>
      </h1>
      <p class="subtitle">
        "Where your secrets and images go to die... permanently archived for your eternal shame"
      </p>
    </div>

    <!-- Search Bar -->
    <div class="search-container p-4 mb-4">
      <div class="row g-3 align-items-end">
        <div class="col-md-8">
          <label for="search-input" class="form-label">
            <i class="bi bi-search scary-icon"></i> Hunt for Confessions
          </label>
          <input type="text" id="search-input" class="form-control" 
                 maxlength="100" 
                 placeholder="Search through the digital graveyard of comments...">
        </div>
        <div class="col-md-4">
          <button type="button" id="clear-search" class="btn btn-outline-primary w-100">
            <i class="bi bi-arrow-clockwise"></i> Show All Victims
          </button>
        </div>
      </div>
      
      <div id="search-stats" class="search-stats mt-3" style="display: none;">
        <i class="bi bi-graph-up scary-icon"></i> 
        <span id="search-results-text"></span>
      </div>
    </div>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <ul class="message-list">
          {% for category, message in messages %}
            <li class="{{ category if category in ['warning', 'danger'] else '' }}">
              {% if category == 'warning' %}
                <i class="bi bi-shield-exclamation scary-icon"></i>
              {% elif category == 'danger' %}
                <i class="bi bi-exclamation-triangle-fill scary-icon"></i>
              {% else %}
                <i class="bi bi-exclamation-triangle scary-icon"></i>
              {% endif %}
              {{ message }}
            </li>
        {% endfor %}
      </ul>
    {% endif %}
  {% endwith %}

    <!-- Upload Form -->
    <div class="form-container p-4 mb-5">
      <h3 class="text-center mb-4">
        <i class="bi bi-cloud-upload scary-icon"></i>
        Submit Your Digital Soul
      </h3>
      <em>Images are deleted every 2 hours to save earth from your sins</em>
      <p class="text-center text-muted mb-4">
        <em>"Every upload is a step closer to digital damnation"</em>
      </p>

  <form method="post" enctype="multipart/form-data" id="entry-form"
        data-max-bytes="{{ max_size_bytes }}"
        data-allowed-exts='{{ allowed_exts | tojson }}'
        data-allowed-mimes='{{ allowed_mimes | tojson }}'>
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

        <div class="mb-4">
          <label for="comment-input" class="form-label">
            <i class="bi bi-chat-quote scary-icon"></i> Confession Text
          </label>
          <input type="text" name="comment" id="comment-input" class="form-control" 
                 maxlength="500" 
                 placeholder="Whisper your darkest digital secrets here...">
          <div class="form-text text-muted">
            <i class="bi bi-info-circle"></i> Max 500 characters. Choose your words carefully, they're forever.
          </div>
        </div>

        <div class="mb-4">
          <label for="file-input" class="form-label">
            <i class="bi bi-image scary-icon"></i> Evidence Upload
          </label>
          <input type="file" name="file" id="file-input" class="form-control" 
                 accept="image/png, image/jpeg">
          <div class="form-text text-muted">
            <i class="bi bi-shield-exclamation"></i> PNG/JPEG only. Your image will be scrutinized and judged.
          </div>
        </div>

        <button type="submit" class="btn btn-primary w-100">
          <i class="bi bi-send scary-icon"></i> 
          Seal Your Digital Fate
        </button>
  </form>
    </div>

    <!-- Results Table -->
    <div class="mt-5">
      <h3 class="mb-4">
        <i class="bi bi-archive scary-icon"></i>
        Archive of Digital Sins
        <span id="results-badge" class="badge bg-secondary ms-2" data-total-count="{{ total_count }}">{{ total_count }} Total Victims</span>
      </h3>
      
      {% if entries %}
        <div class="table-responsive">
          <table class="table table-hover align-middle">
    <thead>
      <tr>
                <th><i class="bi bi-chat-text"></i> Confession</th>
                <th><i class="bi bi-camera"></i> Evidence</th>
      </tr>
    </thead>
            <tbody id="entries-tbody">
      {% for e in entries %}
              <tr class="entry-row" data-confession="{{ e.text or '' }}">
                <td class="confession-column">
                  {% if e.text %}
                    <div class="confession-text">{{ e.text }}</div>
                  {% else %}
                    <em class="text-muted">Silent victim... image speaks louder than words</em>
                  {% endif %}
                </td>
        <td>
          {% if e.image_filename %}
                    <a href="{{ url_for('main.uploaded_file', filename=e.image_filename) }}" 
                       target="_blank" 
                       class="btn btn-outline-primary btn-sm image-link">
                      <i class="bi bi-eye scary-icon"></i> View Evidence
                    </a>
                    <small class="text-muted d-block mt-1">
                      <i class="bi bi-file-image"></i> {{ e.image_filename }}
                    </small>
          {% else %}
                    <span class="text-muted">
                      <i class="bi bi-image-alt"></i> No visual evidence
                    </span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
        </div>
      {% else %}
        <div id="no-results" class="no-results" style="display: none;">
          <i class="bi bi-ghost" style="font-size: 3rem; color: var(--text-muted);"></i>
          <h4 class="mt-3">The Digital Graveyard is Empty</h4>
          <p id="no-results-text">No confessions match your search. The secrets remain buried deeper...</p>
        </div>
        
        {% if not entries %}
        <div class="no-results">
          <i class="bi bi-ghost" style="font-size: 3rem; color: var(--text-muted);"></i>
          <h4 class="mt-3">The Digital Graveyard is Empty</h4>
          <p>No souls have confessed yet. Be the first to submit your digital sins.</p>
        </div>
        {% endif %}
      {% endif %}
    </div>
  </div>

  <script src="{{ url_for('static', filename='myscript.js') }}"></script>
  <!-- Bootstrap JS for alert dismissal -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
